---
title: Crystal 1.4.0 is released!
version: 1.4.0
summary:
thumbnail: +
author:
---

We are delivering a new release with several bugfixes and improvements. Below we list the most important or interesting changes, without mentioning several bugfixes and smaller enhancements. For more details, visit the [changelog](https://github.com/crystal-lang/crystal/releases/tag/1.4.0). Breaking changes are marked with ⚠️.

Pre-built packages are available on [GitHub Releases](https://github.com/crystal-lang/crystal/releases/tag/1.4.0) and our official distribution channels.
See [crystal-lang.org/install](https://crystal-lang.org/install/) for installation instructions.

## Stats

In this release we included [132 changes since the 1.3.2 release](https://github.com/crystal-lang/crystal/pulls?q=is%3Apr+milestone%3A1.4.0) by ?? contributors. We thank all the effort put into improving the language! ❤️

## Towards WASM support

Version 1.4.0 ships with, at the moment, minimal support for compiling into WebAssembly, linking it with a WASI-based LibC. There are several missing important pieces, check the [PR](https://github.com/crystal-lang/crystal/pull/10870). The updated instructions to try it out are:

1. Write a simple Crystal program, let's say: `puts "Hello WebAssembly!"` and name it `main.cr`.

2. Build the WebAssembly module:

```bash
$ crystal build main.cr --cross-compile --target wasm32-unknown-wasi
```

This will generate a `main.wasm` file that is actually a binary wasm file.

3. For the program to work you need a LibC based on WASI. You can download a precompiled one from [wasi-sdk](https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-14/wasi-sysroot-14.0.tar.gz).

4. Additionally, you will need [compiler-rt](https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-14/libclang_rt.builtins-wasm32-wasi-14.0.tar.gz) and `libpcre`, which @lguillaume compiled to wasi [here](https://github.com/lbguilherme/crystal/files/7791111/libpcre-8.45.tar.gz).

5. From the files above, place `libc.a`, `libpcre.a`, `libclang_rt.builtins-wasm32.a`, and `librt.a` in a folder of your choice, say `./lib/`.

6. Link your program and these libraries into a final WebAssembly module:

```bash
$ wasm-ld main.wasm -o main-final.wasm -L./lib -lc -lpcre -lrt -lclang_rt.builtins-wasm32
```

5. Now you have a wasm file that is a final module that can run on any WASI-capable runtime, like Wasmer.

```bash
$ wasmer main-final.wasm 
Hello WebAssembly!
```

## Better inference of instance and class variables

Previous to this release, a simple program like the following failed to type:

```crystal
class DisplayHello
  DELAY = 10.milliseconds

  @timer_countdown = DELAY  # can't infer the type of instance variable '@timer_countdown' of DisplayHello
end
```

Now it compiles fine, inferring correctly that `@timer_countdown` has type `Time::Span`. It is also possible to omit types in other cases too:

```crystal
class DisplayHello

  def initialize(delay : Time::Span)
    @timer_countdown = delay + 10.seconds
  end
end
```


## Other notable changes

- ⚠️ 

---
We have been able to do all of this thanks to the continued support of [84codes](https://www.84codes.com/), [Nikola Motor Company](https://nikolamotor.com/) and every other [sponsor](/sponsors). To maintain and increase the development pace, donations and sponsorships are essential. [OpenCollective](https://opencollective.com/crystal-lang) is available for that. Reach out to [crystal@manas.tech](mailto:crystal@manas.tech) if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!
